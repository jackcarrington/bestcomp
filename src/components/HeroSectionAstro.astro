---
// HeroSection Astro Component - converted from React with 100% visual parity

interface Props {
  title?: string;
  subheading?: string;
  useCurrentDate?: boolean;
  description?: string;
  customTitle?: string;
  customSubheading?: string;
  customDescription?: string;
  serverCurrentMonthYear?: string;
}

const {
  title,
  subheading,
  useCurrentDate,
  description,
  customTitle,
  customSubheading,
  customDescription,
  serverCurrentMonthYear,
} = Astro.props;

// HYDRATION SAFE: Always use server-provided dates, never create client dates
const currentMonthYear = serverCurrentMonthYear || 'Loading...';

// Default content for home page
const defaultTitle = `Best Casino Sites UK - ${currentMonthYear}`;
const defaultDescription = 'Discover the highest-rated, licensed online casinos in the UK.';
const defaultExpandedText =
  ' Our expert picks cover bonuses, game selection, security, and payout speeds to help you find your perfect British casino.';

// Use custom content if provided (for landing pages), then fallback to legacy props, then defaults
const displayTitle = customTitle || title || defaultTitle;
const displayDescription = customDescription || description || defaultDescription;

// Determine what subheading to show: custom subheading, dynamic date, or legacy subheading
const effectiveSubheading = customSubheading || (useCurrentDate ? currentMonthYear : subheading);

// For landing pages with long descriptions, implement read more
const landingPageShortLength = 80;
const finalDescription = customDescription || description;
const isLandingPage = !!(customTitle || title);
const hasLongDescription = isLandingPage && finalDescription && finalDescription.length > landingPageShortLength;
const landingPageShortText = hasLongDescription
  ? finalDescription.substring(0, landingPageShortLength) + '...'
  : finalDescription;
---

<div class="hero-section">
  <header
    class={`relative z-40 px-4 animate-fade-in pl-[8px] pr-[8px] pt-[0px] pb-[0px] mb-8 ${isLandingPage ? '' : 'text-center'}`}
  >
    <div class="max-w-6xl mx-auto">
      <!-- Single responsive H1 for all screen sizes -->
      <h1 class="text-3xl md:text-6xl font-bold leading-tight mt-[8px] mb-[8px] text-center">
        {
          isLandingPage ? (
            <>
              <span class="bg-gradient-to-r from-white via-purple-100 to-white/90 bg-clip-text text-transparent text-[28px] md:text-[48px]">
                {displayTitle}
              </span>
              {effectiveSubheading && (
                <>
                  <span class="bg-gradient-to-r from-white via-white to-white/80 bg-clip-text text-transparent text-[28px] md:text-[48px]">
                    {' '}
                    -{' '}
                  </span>
                  <span class="text-casino-gradient text-[24px] md:text-[42px]">{effectiveSubheading}</span>
                </>
              )}
            </>
          ) : (
            <>
              <span class="bg-gradient-to-r from-white via-white to-white/80 bg-clip-text text-transparent text-[28px] md:text-[48px]">
                Best Casino Sites UK -{' '}
              </span>
              <span class="text-casino-gradient text-[24px] md:text-[42px]">{currentMonthYear}</span>
            </>
          )
        }
      </h1>

      <div
        class={`text-lg md:text-xl text-white/90 max-w-3xl mx-auto leading-relaxed mt-[8px] mb-[8px] ${isLandingPage ? 'text-left' : 'text-center'}`}
      >
        {
          isLandingPage ? (
            <div class="landing-page-content">
              <div class="short-content">{landingPageShortText || ''}</div>
              <div class="full-content hidden">{finalDescription || ''}</div>
            </div>
          ) : (
            <div class="inline whitespace-pre-wrap">
              {displayDescription}
              <span class="expanded-text hidden">{defaultExpandedText}</span>
            </div>
          )
        }

        <!-- Homepage read more button -->
        {
          !isLandingPage && (
            <button
              class="read-more-btn ml-2 text-[var(--casino-gold)] hover:text-[var(--casino-purple)] transition-colors inline-flex items-center text-sm font-medium"
              data-type="homepage"
            >
              <span class="read-more-text">read more</span>
              <span class="read-less-text hidden">less</span>
              <svg class="chevron-down w-3 h-3 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M19 9l-7 7-7-7" />
              </svg>
              <svg class="chevron-up w-3 h-3 ml-1 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M5 15l7-7 7 7" />
              </svg>
            </button>
          )
        }

        <!-- Landing page read more button -->
        {
          hasLongDescription && (
            <button
              class="read-more-btn ml-2 text-[var(--casino-gold)] hover:text-[var(--casino-purple)] transition-colors inline-flex items-center text-sm font-medium"
              data-type="landing"
            >
              <span class="read-more-text">read more</span>
              <span class="read-less-text hidden">read less</span>
              <svg class="chevron-down w-3 h-3 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M19 9l-7 7-7-7" />
              </svg>
              <svg class="chevron-up w-3 h-3 ml-1 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width={2} d="M5 15l7-7 7 7" />
              </svg>
            </button>
          )
        }
      </div>

      <!-- Features -->
      <div class="hidden md:flex flex-wrap justify-center gap-6 md:gap-8 mt-[8px] mb-[8px]">
        <div class="flex items-center space-x-2 text-white/90">
          <svg class="text-[var(--casino-gold)] w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"
            ></path>
          </svg>
          <span class="font-semibold">Licensed & Secure</span>
        </div>
        <div class="flex items-center space-x-2 text-white/90">
          <svg class="text-[var(--casino-gold)] w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
          </svg>
          <span class="font-semibold">Fast Payouts</span>
        </div>
        <div class="flex items-center space-x-2 text-white/90">
          <svg class="text-[var(--casino-gold)] w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 8v13m0-13V6a2 2 0 112 2h-2zm0 0V5.5A2.5 2.5 0 109.5 8H12zm-7 4h14M5 12a2 2 0 110-4h14a2 2 0 110 4M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"
            ></path>
          </svg>
          <span class="font-semibold">Best Bonuses</span>
        </div>
        <div class="flex items-center space-x-2 text-white/90">
          <svg class="text-[var(--casino-gold)] w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"></path>
          </svg>
          <span class="font-semibold">Mobile Optimised</span>
        </div>
      </div>
    </div>
  </header>
</div>

<script>
  /* eslint-disable prettier/prettier */
  // Google Ads Compliant: Simple read-more functionality scoped to component instance
  function initReadMoreButtons() {
    const readMoreButtons = document.querySelectorAll('.read-more-btn');

    readMoreButtons.forEach((button) => {
      button.addEventListener('click', function (this: HTMLElement) {
        // Find the component root to scope DOM queries
        const root = this.closest('.hero-section');
        if (!root) return; // Safety check

        const buttonType = this.dataset.type;
        let expandedContent;
        const readMoreText = this.querySelector('.read-more-text');
        const readLessText = this.querySelector('.read-less-text');
        const chevronDown = this.querySelector('.chevron-down');
        const chevronUp = this.querySelector('.chevron-up');

        if (buttonType === 'homepage') {
          expandedContent = root.querySelector('.expanded-text');
        } else if (buttonType === 'landing') {
          expandedContent = root.querySelector('.short-content');
          const fullContent = root.querySelector('.full-content');

          if (expandedContent && fullContent) {
            const isShowing = !expandedContent.classList.contains('hidden');
            expandedContent.classList.toggle('hidden', isShowing);
            fullContent.classList.toggle('hidden', !isShowing);
          }
        }

        if (buttonType === 'homepage' && expandedContent) {
          const isHidden = expandedContent.classList.contains('hidden');
          expandedContent.classList.toggle('hidden', !isHidden);
        }

        if (readMoreText && readLessText) {
          readMoreText.classList.toggle('hidden');
          readLessText.classList.toggle('hidden');
        }

        if (chevronDown && chevronUp) {
          chevronDown.classList.toggle('hidden');
          chevronUp.classList.toggle('hidden');
        }
      });
    });
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initReadMoreButtons);
  } else {
    initReadMoreButtons();
  }
</script>
